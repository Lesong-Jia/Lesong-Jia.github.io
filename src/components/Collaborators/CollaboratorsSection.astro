---
/**
 * 合作者：标题左、查看全部右；网格卡片（头像 + 姓名 + 职位），参考 3x4 网格格式
 */
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import { getLocalizedPath, t } from "@/utils/i18n";

// 从 URL 路径中提取语言
const lang = (Astro.url.pathname.startsWith("/en/") ? "en" : "zh") as "zh" | "en";

const all = await getCollection("collaborators", ({ data }) => data.draft !== true);
// 只显示标记为在主页显示的合作者，按homepageOrder排序
const featured = all
	.filter((entry) => entry.data.showOnHomepage === true)
	.sort((a, b) => {
		const orderA = a.data.homepageOrder ?? 999;
		const orderB = b.data.homepageOrder ?? 999;
		return orderA - orderB;
	});
---

<section id="collaborators" class="site-container scroll-mt-10 py-10 md:py-12">
	<div class="mx-auto max-w-6xl">
		<div class="mb-10 flex flex-wrap items-end justify-between gap-4 md:mb-12">
			<h2 class="h2 shrink-0 text-pretty uppercase">
				{t("collaborators.title", lang)}
			</h2>
			<a href={getLocalizedPath("/collaborators", lang)} class="text-sm text-base-600 underline underline-offset-2 hover:text-base-900">
				{lang === "en" ? "View More" : "查看更多"}
			</a>
		</div>

		<div class="grid grid-cols-2 gap-6 sm:grid-cols-3 md:grid-cols-4">
			{featured.map((entry) => {
				const { name, title, image, nameEn, titleEn } = entry.data;
				const displayName = lang === "en" && nameEn ? nameEn : name;
				const displayTitle = lang === "en" && titleEn ? titleEn : title;
				return (
					<a href={getLocalizedPath(`/collaborators/${entry.id}`, lang)} class="flex flex-col focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2">
						<div class="aspect-square w-full overflow-hidden bg-transparent">
							{image ? (
								<Image
									src={image}
									alt=""
									width={640}
									height={640}
									quality={100}
									class="h-full w-full object-cover"
								/>
							) : (
								<div class="h-full w-full bg-base-200" aria-hidden="true" />
							)}
						</div>
						<h3 class="mt-3 font-heading-2 text-base font-medium text-base-900">
							{displayName}
						</h3>
						<p class="mt-0.5 text-sm text-base-600">
							{displayTitle}
						</p>
					</a>
				);
			})}
		</div>
	</div>
</section>
