---
import NavLink from "@components/Nav/NavLink.astro";
import { type navDropdownItem } from "@config/navData.json";
import { Icon } from "astro-icon/components";

interface Props {
	navItem: navDropdownItem;
	class?: string;
}

const { navItem, class: className } = Astro.props as Props;

// 为语言切换链接动态生成路径
const processedDropdown = navItem.dropdown.map((item) => {
	// 如果是语言切换链接（/en/ 或 /zh/），生成当前页面的对应语言版本
	if (item.link === "/en/" || item.link === "/zh/") {
		const targetLang = item.link === "/en/" ? "en" : "zh";
		const currentPath = Astro.url.pathname;
		// 移除当前语言前缀
		const pathWithoutLang = currentPath.replace(/^\/(zh|en)/, "");
		// 生成目标语言路径
		const targetPath = pathWithoutLang === "/" || pathWithoutLang === "" 
			? `/${targetLang}/` 
			: `/${targetLang}${pathWithoutLang}`;
		return { ...item, link: targetPath };
	}
	return item;
});
---

<!-- non-mobile dropdown menu -->
<li class="dropdown group relative">
	<button
		class="nav__link--base flex h-10 items-center gap-1"
		type="button"
		aria-label={`${navItem.text} dropdown menu`}
	>
		{navItem.text}
		<Icon name="tabler:chevron-down" aria-hidden="true" class="size-4" />
	</button>
	<div
		class={`dropdown-content absolute left-1/2 -translate-x-1/2 -ml-1 -mt-1 transition-all top-[90%] invisible opacity-0 z-10 ${className}`}
	>
		<ul
			class="bg-white mt-3 w-fit min-w-[9rem] max-w-[18rem] rounded-none p-2 text-center"
		>
			{processedDropdown.map((dropdownItem) => (
				<NavLink navItem={dropdownItem} class="justify-center" />
			))}
		</ul>
	</div>
</li>

<style>
	.dropdown {
		/* when dropdown is hovered over (mouse) or focused (keyboard tabbing), open it with animation */
		&:hover > .dropdown-content,
		&:focus-within > .dropdown-content {
			transition:
				opacity 0.15s ease-out,
				visibility 0.15s ease-out,
				top 0.15s ease-out;
			visibility: visible;
			top: 100%;
			opacity: 100%;
		}
	}
</style>
