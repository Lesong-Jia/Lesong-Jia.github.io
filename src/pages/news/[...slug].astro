---
import BaseLayout from "@layouts/BaseLayout.astro";
import type { InferGetStaticPropsType } from "astro";
import type { CollectionEntry } from "astro:content";
import { getCollection, render } from "astro:content";
import { Image } from "astro:assets";

export async function getStaticPaths() {
	const items = await getCollection("news", ({ data }) => data.draft !== true);
	return items.map((entry) => ({
		params: { slug: entry.id },
		props: entry,
	}));
}

type Props = InferGetStaticPropsType<typeof getStaticPaths>;
const entry = Astro.props as CollectionEntry<"news">;
const { Content } = await render(entry);
const { title, date, heroImage } = entry.data;
const dateStr = date.toLocaleDateString("zh-CN", { year: "numeric", month: "long", day: "numeric" });
---

<BaseLayout title={title} description={entry.data.description} navStartStyle="default">
	<article class="site-container pt-24 pb-16 md:pt-36 md:pb-24">
		<div class="mx-auto max-w-3xl">
			<header class="mb-8">
				<time class="text-base text-base-500">{dateStr}</time>
				<h1 class="mt-2 font-heading-1 text-3xl font-semibold text-pretty md:text-4xl">
					{title}
				</h1>
			</header>
			<div class="markdown-content text-base-700 max-w-none">
				<Content />
			</div>

			{heroImage && (
				<div class="mt-8">
					<Image
						src={heroImage}
						alt=""
						width={960}
						height={720}
						class="w-full h-auto"
					/>
				</div>
			)}

			<div class="mt-8 text-right">
				<a
					href="/news"
					class="text-sm text-base-600 underline underline-offset-2 hover:text-base-900"
				>
					返回全部
				</a>
			</div>
		</div>
	</article>
</BaseLayout>
